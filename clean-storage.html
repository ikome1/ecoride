<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nettoyage localStorage - EcoRide</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            background: #dc2626;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #b91c1c;
        }
        .info {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üßπ Nettoyage du localStorage</h1>
    
    <div class="info">
        <h2>Donn√©es actuelles dans localStorage :</h2>
        <div id="currentData"></div>
    </div>
    
    <div>
        <button onclick="cleanCurrentUser()">Nettoyer uniquement l'utilisateur connect√©</button>
        <button onclick="cleanAll()">Nettoyer TOUT le localStorage</button>
        <button onclick="fixEmployees()">Corriger les r√¥les des employ√©s</button>
        <button onclick="removeEmploye1FromUsers()">Supprimer employe1 de la table users</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        function displayCurrentData() {
            const currentUser = localStorage.getItem('ecoride_current_user');
            const users = localStorage.getItem('ecoride_users');
            const employees = localStorage.getItem('ecoride_employees');
            const admins = localStorage.getItem('ecoride_admins');
            
            let html = '<h3>Utilisateur connect√© :</h3>';
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    html += `<pre>${JSON.stringify(user, null, 2)}</pre>`;
                } catch (e) {
                    html += `<p>Erreur: ${e.message}</p>`;
                }
            } else {
                html += '<p>Aucun utilisateur connect√©</p>';
            }
            
            html += '<h3>Table users :</h3>';
            if (users) {
                try {
                    const usersList = JSON.parse(users);
                    html += `<p>Nombre: ${usersList.length}</p>`;
                    html += `<pre>${JSON.stringify(usersList.map(u => ({pseudo: u.pseudo, role: u.role})), null, 2)}</pre>`;
                } catch (e) {
                    html += `<p>Erreur: ${e.message}</p>`;
                }
            } else {
                html += '<p>Vide</p>';
            }
            
            html += '<h3>Table employees :</h3>';
            if (employees) {
                try {
                    const employeesList = JSON.parse(employees);
                    html += `<p>Nombre: ${employeesList.length}</p>`;
                    html += `<pre>${JSON.stringify(employeesList.map(e => ({pseudo: e.pseudo, role: e.role})), null, 2)}</pre>`;
                } catch (e) {
                    html += `<p>Erreur: ${e.message}</p>`;
                }
            } else {
                html += '<p>Vide</p>';
            }
            
            html += '<h3>Table admins :</h3>';
            if (admins) {
                try {
                    const adminsList = JSON.parse(admins);
                    html += `<p>Nombre: ${adminsList.length}</p>`;
                    html += `<pre>${JSON.stringify(adminsList.map(a => ({pseudo: a.pseudo, role: a.role})), null, 2)}</pre>`;
                } catch (e) {
                    html += `<p>Erreur: ${e.message}</p>`;
                }
            } else {
                html += '<p>Vide</p>';
            }
            
            document.getElementById('currentData').innerHTML = html;
        }
        
        function cleanCurrentUser() {
            localStorage.removeItem('ecoride_current_user');
            showResult('‚úÖ Utilisateur connect√© supprim√© du localStorage', 'success');
            displayCurrentData();
        }
        
        function cleanAll() {
            localStorage.clear();
            showResult('‚úÖ Tout le localStorage a √©t√© nettoy√©', 'success');
            displayCurrentData();
        }
        
        function fixEmployees() {
            const employees = localStorage.getItem('ecoride_employees');
            if (employees) {
                try {
                    const employeesList = JSON.parse(employees);
                    let fixed = false;
                    employeesList.forEach(emp => {
                        if (!emp.role || emp.role !== 'employee') {
                            emp.role = 'employee';
                            fixed = true;
                        }
                    });
                    if (fixed) {
                        localStorage.setItem('ecoride_employees', JSON.stringify(employeesList));
                        showResult('‚úÖ R√¥les des employ√©s corrig√©s', 'success');
                    } else {
                        showResult('‚ÑπÔ∏è Aucune correction n√©cessaire', 'info');
                    }
                } catch (e) {
                    showResult('‚ùå Erreur: ' + e.message, 'error');
                }
            }
            displayCurrentData();
        }
        
        function removeEmploye1FromUsers() {
            const users = localStorage.getItem('ecoride_users');
            if (users) {
                try {
                    const usersList = JSON.parse(users);
                    const filtered = usersList.filter(u => u.pseudo !== 'employe1');
                    if (filtered.length !== usersList.length) {
                        localStorage.setItem('ecoride_users', JSON.stringify(filtered));
                        showResult('‚úÖ employe1 supprim√© de la table users', 'success');
                    } else {
                        showResult('‚ÑπÔ∏è employe1 n\'existe pas dans la table users', 'info');
                    }
                } catch (e) {
                    showResult('‚ùå Erreur: ' + e.message, 'error');
                }
            } else {
                showResult('‚ÑπÔ∏è Table users vide', 'info');
            }
            displayCurrentData();
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = type === 'success' ? 'success' : 'info';
            resultDiv.textContent = message;
            setTimeout(() => {
                resultDiv.textContent = '';
            }, 5000);
        }
        
        // Afficher les donn√©es au chargement
        displayCurrentData();
    </script>
</body>
</html>

